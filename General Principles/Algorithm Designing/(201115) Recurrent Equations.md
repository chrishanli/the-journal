# 求解分治法的递归方程式

## 简介

介绍求解分治法递归方程的若干方法。

所谓递归方程，即一个运算时间关于问题规模的表达式：
$$
T(n)= \left\{
\begin{aligned}
&O(1), & n=n_0, \\
&kT(n/m)+f(n), & n>n_0.\\
\end{aligned}
\right.
\tag 1
$$
上式中：

- $T(n)$ 是运算时间 (运算次数)
- $k,m$ 表示分治法每次都将原问题分解成 $k$ 个**规模为 $n/m$** 的子问题
- $f(n)$ 表示递归求解后，合并子问题所需的运算次数

所谓求解递归方程，即求出上式的化简后表达式。在算法分析时，一般求解后，写成 $T(n)=O(g(n))$ 的形式，而不直接写出化简后的表达式 (因为太复杂而且没有啥意义，用大 $O$ 表示的阶来表达就可以了)。

## 方法：直接反复代入求解

### 理论分析

式 $(1)$ 经反复代入的过程如下 (假设最小问题规模为 $n_0=1$)：
$$
\begin{aligned}
T(n) &=k(kT(n/m^2)+f(n/m)) + f(n) \\
&=k^2T(n/m^2)+kf(n/m) + f(n) \\
&=k^2(kT(n/m^3)+f(n/m^2))+kf(n/m) + f(n) \\
&=k^3T(n/m^3)+k^2f(n/m^2)+kf(n/m) + f(n) \\
& ...\\
&=k^{\log_m n}T(1) + \sum_{i=0}^{\log_m{(n-1)}}k^if(n/m^i) \\
&=n^{\log_m k} + \sum_{i=0}^{\log_m{(n-1)}}k^if(n/m^i)
\end{aligned} \tag{2}
$$
根据上式，**在 $f(n)$ 为常数 (即 $O(1)$) 或线性函数 (即 $O(n)$) 时**，可分为几种情况：

- 第 1 项的阶比后一项的要大，或他俩同阶。在分析问题时间复杂度的阶时，只考虑前面的 1 项，即
  $$
  T(n)=O(n^{\log_m k}) \tag{3}
  $$
  例如，对于大整数乘法问题，递归方程式是：
  $$
  T(n)= \left\{
  \begin{aligned}
  &O(1), & n=1, \\
  &3T(n/2)+O(n), & n>1.\\
  \end{aligned}
  \right.
  $$
  则算法求解的时间复杂度是 $T(n) = O(n^{\log_2 3}) \approx O(n^{1.59})$

- 第 1 项的阶比后一项的要小。这种情况通常出现在 **(1)** **$f(n)$ 为线性、并且 $k=m$** 的时候，或者是 **(2)** **当 $k=1$ 的任何时候**。这时算阶只考虑后 1 项，即
  $$
  T(n)=O(\sum_{i=0}^{\log_m{(n-1)}}k^if(n/m^i)) \tag{4}
  $$
  注意：$f(n/m^i)$ 前面的 $k^i$ 及里面的 $m^i$ 可以看作是常数，而在每次做 $O$ 表达式之间相乘运算时，这两个常数都可被视为 1。

  例如，对于归并排序问题，递归方程式是：
  $$
  T(n)= \left\{
  \begin{aligned}
  &O(1), & n\le 1, \\
  &2T(n/2)+O(n), & n>1.\\
  \end{aligned}
  \right.
  $$
  因为 $f(n)$ 为线性，所以后一项阶表达式为 $O(\sum_{i=0}^{\log(n-1)}k^in/m^i)=O(n\log n)$；

  并且又有 $k=m$，所以前一项阶表达式为 $O(n)$，因此复杂度为 $T(n)=O(n\log n)$。

总之，不管是何种情况，只需对前边和后边两项的阶的相对大小进行讨论，可得出的递归方程的解通常会是如下四种形式之一：
$$
O(n^k), O(n \log n), O(\log n), O(k^n)
$$

### 实例

Hanoi 塔问题求解时间的递归方程如下：
$$
T(n)= \left\{
\begin{aligned}
&O(1), & n=1, \\
&2T(n-1)+1, & n>1.\\
\end{aligned}
\right.
$$
递归求解如下：
$$
\begin{aligned}
T(n) &= 2T(n-1)+1 \\
&= 2(2T(n-2)+1)+1 \\
&= 4T(n-2)+2+1 \\
&= 4(2T(n-3)+1)+2+1 \\
&= 8T(n-3)+4+2+1 \\
&...\\
&= 2^{n-1}T(1)+2^{n-2}+...+2+1 \\
&= \sum_{i=0}^{n-1}2^i \\
&= 2^n-1
\end{aligned}
$$
故 Hanoi 问题递归算法的时间复杂度伪 $T(n)=O(2^n)$。

附：等比数列前 $n$ 项和公式：$S_n=\frac{a_1(1-q^n)}{1-q}$，因此上式中的求和式的计算过程为：
$$
\sum_{i=0}^{n-1}2^i = \frac{1\cdot (1-2^{n})}{1-2}=2^n-1
$$

## 其他方法

暂时没有遇到代入法求不了的方程，遇到先再说

